addons:
  apt:
    sources:
        - sourceline: 'ppa:team-gcc-arm-embedded/ppa'
    packages:
        # router cross-compiling
        - gcc-arm-embedded
        # router yotta dependencies
        - srecord
        - python-setuptools
        - cmake
        - build-essential
        - ninja-build
        - python-dev
        - libffi-dev
        - libssl-dev
        # desktop app windows packaging
        - wine1.6

install:
    - sudo pip install yotta

before_script:
  - export DISPLAY=:99.0; sh -e /etc/init.d/xvfb start # magic required for running electron-mocha tests

script:
    - if [ "$TRAVIS_BRANCH" == "router" ] ; then cd router && sh ci.sh router.hex; fi
    - if [ "$TRAVIS_BRANCH" == "ci-fix" ] || [ "$TRAVIS_BRANCH" == "desktop-app" ] ; then
        cd desktop_app
        && npm install
        && npm install 7zip-bin-linux
        && npm test
        && npm run pack:linux
        && npm run pack:win
        ; fi
